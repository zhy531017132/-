## 4.2.1-fixed.1 版

该版本于 2021 年 5 月 31 日发布。

### 新增特性

#### 获取设备列表添加触发浏览器的媒体设备权限申请的参数

- `getDevices` 添加 `skipPermissionCheck` 参数
- `getCameras` 添加 `skipPermissionCheck` 参数
- `getMicrophones` 添加 `skipPermissionCheck` 参数
- `getPlaybackDevices` 添加 `skipPermissionCheck` 参数

#### 添加加密方案

- 添加 `RTCClient.setEncryptionConfig` 方法

### 改进

- 日志优化
- PC 和 H5 浏览器兼容
- Windows 上禁用采集设备后进行媒体采集，SDK 抛出的错误由 `UNEXPECTED_ERROR` 调整为 `NOT_READABLE`。

### 修复

- PC 端 safari 无法进行音频通讯
- PC 端 safari 视频窗口无法自动播放
- H5 视频无法自动播放
- 开启大小流的情况下，切换摄像头小流仍然显示的是之前的图像
- 开启大小流的情况下，视频轨道 setEnabled(false) 小流未被关闭


## 4.2.0 版

该版本于 2021 年 4 月 29 日发布。

### 新增特性

#### 音频状态改变

- IBufferSourceAudioTrack 新增 `source-state-change` 事件。
- 新增 `onAudioAutoplayFailed` 音频播放失败回调。

#### 音量检测

- 新增 `enableAudioVolumeIndicator` 方法，开启后 SDK 定期报告正在说话的用户及音量大小。

#### 网络质量

- 添加 `getRemoteNetworkQuality` 方法获取远程用户的网络质量。

### 改进

- 优化上报事件
- Windows 上禁用采集设备后进行媒体采集，SDK 抛出的错误由 `UNEXPECTED_ERROR` 调整为 `NOT_READABLE`。
- 本地音视频轨道 `setEnabled(true)` 后，将释放采集设备，即摄像头停止采集视频，麦克风停止采集音频。
- 当所有本地音视频轨道被 `setEnabled(true)` 后，降低网络等性能的消耗。
- 优化保活逻辑。
- Electron 屏幕共享流程。

### 修复

- 部分 Promise 接口无法通过 catch 捕获到异常错误。
- 入会之前设置小流参数无效。
- 动态设置参数小流会影响大流。
- leave 时，connection-state-change 不回调。
- 入会成功之后token 即将过期或已经过期的回调不触发。
- 创建视频轨道默认配置不生效。
- 优化部分日志输出，便于开发者差错。
- 修复 `createBufferSourceAudioTrack` 设置 `requestCache` 参数无效。
- 修复 `MicrophoneAudioTrack.setDevice`  没有 `resolve`。
- 修复 token 失效之后一直重连。修复 `createScreenVideoTrack` 传入 `electronScreenSourceId` 无效。
- 修复 `createTrack` 第一个参数 `config` 不能为 null。
- 修复 `createBufferSourceAudioTrack` 接口 `cacheOnlineFile` 配置无效。
- 修复 `createBufferSourceAudioTrack` 接口 `source` 为 `AudioBuffer`类型的参数无效。修复 ReportAV 数据错误。

## 4.1.3 版

该版本于 2021 年 1 月 21 日发布。

### 新增特性

#### 公有云升级双网关

v4.1.3 公有云网关升级至双网关。

### 改进

- 调整部分上报数据，数据从浮点数改为整数。
- RTC online 添加 'DevType' 和 'ChanType'两个字段，服务端回调事件需要。 

### 修复

- 修复订阅小流时远端关闭双流导致画面卡死。
- 修复 client.join 有错误 catch 捕捉不到。


## 4.1.2 版

该版本于 2020 年 12 月 1 日发布。
### 新增特性

#### 配置私有云

- setParameters 添加 UserQuality 配置项，用于配置是否上报本地网络质量。

#### 添加音频检测

- 在client里面通过 on 方法，监听'volume-indicator'回调。

#### 上下行网络质量水平

- network-quality回调添加 uid 参数，并支持远端用户状态。

### 问题修复

- rtc peerconnection failed ws未断时发送offline。


## 4.1.0 版

该版本于 2020 年 10 月 3 日发布。

### 新增特性

#### 客户端截图

v4.1.0 新增 `getCurrentFrameData` 方法，用于获取当前渲染的视频帧数据。

#### 音频播放设备管理

v4.1.0 新增了以下方法和回调，用于音频播放设备的管理：

- setPlaybackDevice: 用于设置音频播放设备，比如扬声器。该方法仅支持 Chrome 浏览器。
- getPlaybackDevices: 用于获取可用的音频播放设备。
- onPlaybackDeviceChanged: 用于提示有音频播放设备被添加或移除。

#### 音视频流回退策略

v4.1.0 新增 `setStreamFallbackOption` 方法，用于设置在弱网情况下订阅音视频流的回退策略。

#### 本地网络质量回调

v4.1.0 新增 `network-quality` 回调，监听本地网络上下行质量。

### 改进

- `localAudioTrack.setVolume` 、`remoteAudioTrack.setVolume` 限制音量范围 0-1000

### API 变更

#### 新增

- `ArRTC.getPlaybackDevices`
- `ArRTC.onPlaybackDeviceChanged`
- `Client.setStreamFallbackOption`
- `Client.getLocalAudioStats`
- `Client.getLocalVideoStats`
- `Client.getRemoteAudioStats`
- `Client.getRemoteVideoStats`
- `Client.on("network-quality")`
- `LocalVideoTrack.getCurrentFrameData`
- `RemoteVideoTrack.getCurrentFrameData`
- `LocalAudioTrack.setPlaybackDevice`
- `RemoteAudioTrack.setPlaybackDevice`

#### 废弃

废弃了 `LocalTrack.getStats` 和 `RemoteTrack.getStats`，请使用 `Client.getLocalAudioStats` 等方法来获取本地和远端的媒体质量信息。